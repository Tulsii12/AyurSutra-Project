<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Schedule Appointment</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      .main-container{max-width:1400px;margin:2rem auto;padding:0 2rem}
      .dashboard-grid{display:grid;grid-template-columns:1fr 1fr;gap:2rem;margin-bottom:2rem}
      .dashboard-section{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 10px 40px rgba(45,90,45,.1);position:relative}
      .section-header{display:flex;align-items:center;gap:1rem;margin-bottom:1.5rem}
      .section-icon{width:40px;height:40px;border-radius:10px;background:#0a7e3d;display:flex;align-items:center;justify-content:center;color:#fff}
      .section-title{font-size:1.5rem;color:#0a7e3d;font-weight:600}
      .calendar-container{background:#f2f7f2;border-radius:20px;padding:1rem}
      .calendar-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
      .calendar-month{font-weight:700;color:#2d5a2d}
      .calendar-grid{display:grid;grid-template-columns:repeat(7,1fr);gap:2px;background:#e8f5e8;border-radius:15px;overflow:hidden}
      .calendar-day-header{background:#0a7e3d;color:#fff;padding:.6rem .3rem;text-align:center;font-weight:600;font-size:.75rem}
      .calendar-day{background:#fff;padding:.5rem .3rem;min-height:60px;position:relative;display:flex;flex-direction:column;align-items:center;justify-content:flex-start;border-radius:8px;margin:1px}
      .calendar-day.other-month{background:#f3f3f3;color:#ccc;opacity:.6}
      .calendar-day.today{background:#e8f5e8;border:2px solid #0a7e3d}
      .calendar-day.has-appointment{background:linear-gradient(145deg,#fff8e1 0%,#ffecb3 100%);border-left:3px solid #ffa726}
      .calendar-day.completed-appointment{background:linear-gradient(145deg,#e8f5e8 0%,#c8e6c9 100%);border-left:3px solid #0a7e3d}
      .day-number{font-weight:700;margin-bottom:.2rem;font-size:.9rem;color:#2d5a2d}
      .appointment-indicator{font-size:1rem;color:#ffa726;margin-bottom:.2rem}
      .appointment-time{font-size:.6rem;color:#4a7c4a;font-weight:600;background:rgba(74,124,74,.1);padding:.1rem .3rem;border-radius:8px;border:1px solid rgba(74,124,74,.2)}
      .appointment-details{position:absolute;top:100%;left:50%;transform:translateX(-50%);background:#fff;border:1px solid #e8f5e8;border-radius:12px;padding:1rem;box-shadow:0 8px 32px rgba(0,0,0,.15);z-index:10;display:none;min-width:200px}
      .calendar-day:hover .appointment-details{display:block}
      .therapy-grid{display:grid;gap:1rem}
      .therapy-item{background:#f8f9f8;border-radius:12px;padding:1.5rem;border-left:4px solid #4a7c4a}
      .therapy-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem}
      .therapy-name{font-weight:600;color:#2d5a2d;font-size:1.1rem}
      .therapy-status{padding:.3rem .8rem;border-radius:20px;font-size:.8rem;font-weight:500}
      .status-active{background:#e8f5e8;color:#2e7d32}
      .status-completed{background:#e3f2fd;color:#1976d2}
      .status-scheduled{background:#fff3e0;color:#f57c00}
      .therapy-progress{margin-bottom:1rem}
      .progress-bar{background:#e8f5e8;border-radius:10px;height:8px;overflow:hidden}
      .progress-fill{height:100%;background:#0a7e3d}
      .chart-container{background:#f8f9f8;border-radius:12px;padding:1rem;height:200px;position:relative}
      .symptom-chart{background:#f8f9f8;border-radius:12px;padding:1rem;height:250px}
    </style>
</head>
<body>
    <!-- Header -->
      <header class="bg-green-800 text-white shadow-md">
        <div class="container mx-auto px-8 py-4 flex flex-col md:flex-row md:justify-center md:gap-x-12 items-center">
            <div class="flex items-center space-x-8 mb-4 md:mb-0">
                <div class="bg-green-600 w-8 h-8 rounded-full flex items-center justify-center text-white font-bold">P</div>
                <div>
                    <h1 class="text-lg font-bold">AyurSutra</h1>
                    <p class="text-sm text-gray-300">Panchakarma Center</p>
                </div>
            </div>
            <nav class="flex-grow">
                <ul class="flex justify-center md:justify-end space-x-16 font-medium">
                    <li><a href="index.html" class="hover:text-green-300">Home</a></li>
                    <li><a href="about.html" class="hover:text-green-300">About Us</a></li>
                    <li><a href="shop.html" class="hover:text-green-300">Shop</a></li>
                    <li><a href="schedule.html" class="hover:text-green-300">Schedule</a></li>
                    <li><a href="profile.html" class="text-white bg-green-600 py-2 px-4 rounded-md">Profile</a></li>
                    <li><a href="login.html" class="hover:text-green-300">Login</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <main class="main-container">
        <!-- Patient Basic Info Section -->
        <div class="patient-header">
            <div class="patient-avatar">
                <i class="fas fa-user"></i>
                <div class="status-indicator"></div>
            </div>
            <div class="patient-info">
                <h2>Rajesh Kumar</h2>
                <div class="patient-id">Patient ID: PK-2024-001</div>
                <div class="patient-details">
                    <div class="detail-item">
                        <i class="fas fa-birthday-cake"></i>
                        <span>Age: 45 years</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-venus-mars"></i>
                        <span>Gender: Male</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-phone"></i>
                        <span>+91 98765 43210</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-envelope"></i>
                        <span>rajesh.kumar@email.com</span>
                </div>
                    <div class="detail-item">
                        <i class="fas fa-map-marker-alt"></i>
                        <span>Delhi, India</span>
                    </div>
                    <div class="detail-item">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Member since: Jan 2024</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard Grid -->
        <div class="dashboard-grid">
            <!-- Current Therapy Plan (top-left) -->
            <div class="dashboard-section" style="grid-column: 1 / 2;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-spa"></i>
                    </div>
                    <div class="section-title">Current Therapy Plan</div>
                </div>

                <div class="therapy-grid"></div>
            </div>

            <!-- Calendar (top-right) -->
            <div class="dashboard-section calendar-section" style="grid-column: 2 / 3; max-width: none; margin-left: 0;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="section-title">Appointment Calendar</div>
                </div>
                
                <div class="calendar-container">
                    <div class="calendar-header">
                        <button class="calendar-nav-btn" id="prev-month">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <div class="calendar-month" id="current-month">March 2024</div>
                        <button class="calendar-nav-btn" id="next-month">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    
                    <div class="calendar-grid" id="calendar-grid">
                        <!-- Calendar will be populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Vital Signs Section -->
            <div class="dashboard-section" style="grid-column: 1 / 2;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-heartbeat"></i>
                </div>
                    <div class="section-title">Vital Signs (Latest)</div>
            </div>

                <div class="vital-cards">
                    <div class="vital-card">
                        <div class="vital-icon">
                            <i class="fas fa-tint"></i>
                    </div>
                        <div class="vital-value">142/88</div>
                        <div class="vital-label">Blood Pressure (mmHg)</div>
                        <div class="vital-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>↓ 5 points</span>
                </div>
                </div>

                    <div class="vital-card">
                        <div class="vital-icon">
                            <i class="fas fa-heart"></i>
                        </div>
                        <div class="vital-value">78</div>
                        <div class="vital-label">Pulse Rate (bpm)</div>
                        <div class="vital-trend trend-stable">
                            <i class="fas fa-minus"></i>
                            <span>Stable</span>
            </div>
        </div>

                    <div class="vital-card">
                        <div class="vital-icon">
                            <i class="fas fa-weight"></i>
                </div>
                        <div class="vital-value">78.5</div>
                        <div class="vital-label">Weight (kg)</div>
                        <div class="vital-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>↓ 2.3 kg</span>
                </div>
                    </div>

                    <div class="vital-card">
                        <div class="vital-icon">
                            <i class="fas fa-chart-line"></i>
                </div>
                        <div class="vital-value">26.8</div>
                        <div class="vital-label">BMI <span class="tooltip">ℹ️
                            <span class="tooltiptext">Body Mass Index - calculated as weight(kg) / height(m)²</span>
                        </span></div>
                        <div class="vital-trend trend-down">
                            <i class="fas fa-arrow-down"></i>
                            <span>↓ 0.8</span>
                </div>
                </div>
                </div>

                <div class="chart-container">
                    <canvas id="weightChart"></canvas>
                </div>
                </div>

            

            <!-- Progress Tracker Section (same row as Vital Signs) -->
            <div class="dashboard-section" style="grid-column: 2 / 3;">
                <div class="section-header">
                    <div class="section-icon">
                        <i class="fas fa-chart-area"></i>
                    </div>
                    <div class="section-title">Progress Tracker</div>
                </div>

                <div class="progress-metrics">
                    <div class="metric-card">
                        <div class="metric-value">4.2</div>
                        <div class="metric-label">Avg Pain Score (1-10)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">92%</div>
                        <div class="metric-label">Adherence Rate</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">7.8</div>
                        <div class="metric-label">Energy Level (1-10)</div>
                    </div>
                    <div class="metric-card">
                        <div class="metric-value">6.5</div>
                        <div class="metric-label">Sleep Quality (1-10)</div>
                    </div>
                </div>

                <div class="symptom-chart">
                    <canvas id="symptomChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Medical History Section -->
        <div class="dashboard-section medical-history">
            <div class="section-header">
                <div class="section-icon">
                    <i class="fas fa-clipboard-list"></i>
                </div>
                <div class="section-title">Medical History</div>
            </div>
            
            <div class="condition-item">
                <div class="condition-name">
                    Hypertension <span class="tooltip">ℹ️
                        <span class="tooltiptext">High blood pressure - a chronic condition requiring ongoing management</span>
                    </span>
                </div>
                <div class="condition-details">Diagnosed: 2019 | On medication: Amlodipine 5mg daily</div>
                <div class="severity-badge severity-medium">Moderate</div>
            </div>

            <div class="condition-item">
                <div class="condition-name">
                    Diabetes Type 2 <span class="tooltip">ℹ️
                        <span class="tooltiptext">Type 2 diabetes - managed with diet, exercise, and medication</span>
                    </span>
                </div>
                <div class="condition-details">Diagnosed: 2020 | HbA1c: 7.2% | On Metformin 500mg twice daily</div>
                <div class="severity-badge severity-medium">Moderate</div>
            </div>

            <div class="condition-item">
                <div class="condition-name">Chronic Back Pain</div>
                <div class="condition-details">L4-L5 disc degeneration | Duration: 3 years | Primary reason for Ayurvedic treatment</div>
                <div class="severity-badge severity-high">High</div>
            </div>

            <div class="condition-item">
                <div class="condition-name">Allergies</div>
                <div class="condition-details">Penicillin (severe), Shellfish (mild), Dust mites (mild)</div>
                <div class="severity-badge severity-low">Low</div>
            </div>

            <div class="condition-item">
                <div class="condition-name">Past Procedures</div>
                <div class="condition-details">Appendectomy (2015), Colonoscopy (2022) - Normal findings</div>
                <div class="severity-badge severity-low">Low</div>
            </div>
        </div>

        <!-- Add Session Feedback Section -->
        <div class="dashboard-section feedback-section" style="margin-top:0.8rem;">
          <div class="section-header">
            <div class="section-icon"><i class="fas fa-comment-dots"></i></div>
            <div class="section-title">Session Feedback</div>
          </div>

          <div class="feedback-form bg-white rounded-lg p-6">
            <div class="grid gap-4">
              <!-- Session Date -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Session Date:</label>
                <input type="date" value="2025-09-23" 
                       class="w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500">
              </div>

              <!-- Overall Rating -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Overall Rating:</label>
                <div class="flex gap-2" id="rating">
                  <button class="text-2xl text-gray-400 hover:text-yellow-400">★</button>
                  <button class="text-2xl text-gray-400 hover:text-yellow-400">★</button>
                  <button class="text-2xl text-gray-400 hover:text-yellow-400">★</button>
                  <button class="text-2xl text-gray-400 hover:text-yellow-400">★</button>
                  <button class="text-2xl text-gray-400 hover:text-yellow-400">★</button>
                </div>
              </div>

              <!-- Pain Level -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Pain Level (1-10):</label>
                <div class="relative">
                  <input type="range" min="1" max="10" value="5" 
                         class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                  <span class="absolute right-0 -top-6 text-sm text-gray-600">5</span>
                </div>
              </div>

              <!-- Sleep Quality -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Sleep Quality (1-10):</label>
                <div class="relative">
                  <input type="range" min="1" max="10" value="5"
                         class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-green-600">
                  <span class="absolute right-0 -top-6 text-sm text-gray-600">5</span>
                </div>
              </div>

              <!-- Side Effects -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Side Effects:</label>
                <textarea 
                  class="w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  rows="3"
                  placeholder="Describe any side effects or discomfort..."></textarea>
              </div>

              <!-- Improvements -->
              <div>
                <label class="text-green-800 font-medium block mb-2">Improvements Noticed:</label>
                <textarea 
                  class="w-full rounded-md border-gray-300 shadow-sm focus:border-green-500 focus:ring-green-500"
                  rows="3"
                  placeholder="Describe any improvements or positive changes..."></textarea>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="mt-6">
              <button onclick="submitFeedback()" 
                      class="w-full bg-green-700 text-white py-2 px-4 rounded-md hover:bg-green-800 
                             focus:ring-2 focus:ring-green-500 focus:ring-offset-2">
                Submit Feedback
              </button>
            </div>
          </div>
        </div>

        <!-- Action Buttons -->
        <div class="action-buttons">
            <button class="btn btn-outline" onclick="downloadMedicalSummary()">
                <i class="fas fa-download"></i>
                Download Medical Summary
            </button>
        </div>
    </main>

    <!-- Feedback Modal -->
<div id="feedbackModal" class="fixed inset-0 bg-black/50 hidden items-center justify-center">
  <div class="bg-white rounded-lg w-full max-w-md mx-4">
    <div class="p-6">
      <h3 class="text-lg font-semibold mb-4">Session Feedback</h3>
      
      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Select Session</label>
        <select class="w-full rounded-md border-gray-300 shadow-sm">
          <option>Abhyanga Massage - March 18</option>
          <option>Panchakarma - March 20</option>
          <option>Shirodhara - March 22</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Rating</label>
        <div class="flex gap-2">
          <i class="far fa-star text-2xl cursor-pointer hover:text-yellow-400"></i>
          <i class="far fa-star text-2xl cursor-pointer hover:text-yellow-400"></i>
          <i class="far fa-star text-2xl cursor-pointer hover:text-yellow-400"></i>
          <i class="far fa-star text-2xl cursor-pointer hover:text-yellow-400"></i>
          <i class="far fa-star text-2xl cursor-pointer hover:text-yellow-400"></i>
        </div>
      </div>

      <div class="mb-4">
        <label class="block text-sm font-medium mb-1">Comments</label>
        <textarea class="w-full rounded-md border-gray-300 shadow-sm" rows="3" placeholder="Share your experience..."></textarea>
      </div>

      <div class="flex justify-end gap-3">
        <button onclick="hideFeedbackModal()" class="px-4 py-2 text-sm text-gray-600 hover:text-gray-800">Cancel</button>
        <button onclick="submitFeedback()" class="px-4 py-2 text-sm bg-green-700 text-white rounded-md hover:bg-green-800">Submit Feedback</button>
      </div>
    </div>
  </div>
</div>

    <script>
        // Sample data for charts
        const weightData = {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
            datasets: [{
                label: 'Weight (kg)',
                data: [82.3, 81.8, 81.2, 80.5, 79.8, 78.5],
                borderColor: '#4a7c4a',
                backgroundColor: 'rgba(74, 124, 74, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };

        // Sample appointment data with more appointments
        const appointments = [
            {
                id: 1,
                date: new Date(2024, 2, 3),
                time: '10:00',
                therapy: 'Abhyanga Massage',
                therapist: 'Dr. Anjali Sharma',
                status: 'completed',
                duration: 60,
                notes: 'Excellent session, felt very relaxed'
            },
            {
                id: 2,
                date: new Date(2024, 2, 5),
                time: '09:00',
                therapy: 'Panchakarma',
                therapist: 'Dr. Rajesh Kumar',
                status: 'completed',
                duration: 120,
                notes: 'Good progress, slight discomfort'
            },
            {
                id: 3,
                date: new Date(2024, 2, 7),
                time: '14:00',
                therapy: 'Shirodhara',
                therapist: 'Dr. Priya Patel',
                status: 'completed',
                duration: 45,
                notes: 'Very relaxing session'
            },
            {
                id: 4,
                date: new Date(2024, 2, 9),
                time: '11:00',
                therapy: 'Abhyanga Massage',
                therapist: 'Dr. Anjali Sharma',
                status: 'completed',
                duration: 60,
                notes: 'Follow-up session'
            },
            {
                id: 5,
                date: new Date(2024, 2, 12),
                time: '09:30',
                therapy: 'Basti Treatment',
                therapist: 'Dr. Amit Singh',
                status: 'scheduled',
                duration: 30,
                notes: 'New therapy introduction'
            },
            {
                id: 6,
                date: new Date(2024, 2, 14),
                time: '16:00',
                therapy: 'Panchakarma',
                therapist: 'Dr. Rajesh Kumar',
                status: 'scheduled',
                duration: 120,
                notes: 'Phase 2 treatment'
            },
            {
                id: 7,
                date: new Date(2024, 2, 16),
                time: '10:30',
                therapy: 'Abhyanga Massage',
                therapist: 'Dr. Anjali Sharma',
                status: 'scheduled',
                duration: 60,
                notes: 'Regular session'
            },
            {
                id: 8,
                date: new Date(2024, 2, 18),
                time: '15:00',
                therapy: 'Shirodhara',
                therapist: 'Dr. Priya Patel',
                status: 'scheduled',
                duration: 45,
                notes: 'Mental relaxation therapy'
            },
            {
                id: 9,
                date: new Date(2024, 2, 21),
                time: '11:30',
                therapy: 'Basti Treatment',
                therapist: 'Dr. Amit Singh',
                status: 'scheduled',
                duration: 30,
                notes: 'Follow-up treatment'
            },
            {
                id: 10,
                date: new Date(2024, 2, 23),
                time: '09:00',
                therapy: 'Panchakarma',
                therapist: 'Dr. Rajesh Kumar',
                status: 'scheduled',
                duration: 120,
                notes: 'Deep cleansing session'
            },
            {
                id: 11,
                date: new Date(2024, 2, 26),
                time: '14:30',
                therapy: 'Abhyanga Massage',
                therapist: 'Dr. Anjali Sharma',
                status: 'scheduled',
                duration: 60,
                notes: 'Therapeutic massage'
            },
            {
                id: 12,
                date: new Date(2024, 2, 28),
                time: '10:00',
                therapy: 'Shirodhara',
                therapist: 'Dr. Priya Patel',
                status: 'scheduled',
                duration: 45,
                notes: 'Stress relief session'
            },
            {
                id: 13,
                date: new Date(2024, 2, 30),
                time: '16:30',
                therapy: 'Basti Treatment',
                therapist: 'Dr. Amit Singh',
                status: 'scheduled',
                duration: 30,
                notes: 'Final treatment of month'
            }
        ];

        // Merge stored appointments from schedule.html (saved in localStorage)
        try {
            const storedAppointments = JSON.parse(localStorage.getItem('appointments') || '[]');
            const normalizeTherapyName = (name) => {
                const s = (name || '').toLowerCase();
                if (s.includes('abhyanga')) return 'Abhyanga';
                if (s.includes('shirodhara')) return 'Shirodhara';
                if (s.includes('shirovasti')) return 'Shirovasti';
                if (s.includes('panchakarma')) return 'Panchakarma';
                if (s.includes('basti')) return 'Basti';
                if (s.includes('navarakizhi')) return 'Navarakizhi';
                if (s.includes('patra') && s.includes('pinda')) return 'Patra Pinda Sweda';
                if (s.includes('udwartana')) return 'Udwartana';
                if (s.includes('pizhichil')) return 'Pizhichil';
                if (s.includes('netra') && s.includes('tarpana')) return 'Netra Tarpana';
                if (s.includes('karna') && s.includes('purana')) return 'Karna Purana';
                if (s.includes('gandusha') || s.includes('kavala')) return 'Gandusha/Kavala';
                if (s.includes('lepam')) return 'Lepam';
                if (s.includes('consult')) return 'Initial Consultation';
                if (s.includes('women')) return "Women's Health Treatment";
                return name || 'Therapy';
            };
            storedAppointments.forEach((item) => {
                const parts = (item.date || '').split('-').map(Number);
                if (parts.length === 3) {
                    const jsDate = new Date(parts[0], parts[1] - 1, parts[2]);
                    appointments.push({
                        id: item.id || Date.now(),
                        date: jsDate,
                        time: item.time || '',
                        therapy: normalizeTherapyName(item.therapy || 'Scheduled Appointment'),
                        therapist: item.therapist || 'AyurSutra Clinic',
                        status: item.status || 'scheduled',
                        duration: item.duration || 60,
                        notes: item.notes || ''
                    });
                }
            });
        } catch (e) {
            console.error('Failed to load stored appointments', e);
        }

        // Calendar functionality
        class Calendar {
            constructor() {
                this.currentDate = new Date();
                this.init();
            }

            init() {
                this.renderCalendar();
                this.setupEventListeners();
            }

            setupEventListeners() {
                document.getElementById('prev-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() - 1);
                    this.renderCalendar();
                });

                document.getElementById('next-month').addEventListener('click', () => {
                    this.currentDate.setMonth(this.currentDate.getMonth() + 1);
                    this.renderCalendar();
                });
            }

            renderCalendar() {
                const calendarGrid = document.getElementById('calendar-grid');
                const currentMonth = document.getElementById('current-month');
                
                // Update month display
                currentMonth.textContent = this.currentDate.toLocaleDateString('en-US', { 
                    month: 'long', 
                    year: 'numeric' 
                });

                // expose current month for therapy plan sync
                window.__currentCalendarMonth = {
                    year: this.currentDate.getFullYear(),
                    month: this.currentDate.getMonth()
                };

                // Clear calendar
                calendarGrid.innerHTML = '';

                // Add day headers
                const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayHeaders.forEach(day => {
                    const dayHeader = document.createElement('div');
                    dayHeader.className = 'calendar-day-header';
                    dayHeader.textContent = day;
                    calendarGrid.appendChild(dayHeader);
                });

                // Get first day of month and number of days
                const firstDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), 1);
                const lastDay = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth() + 1, 0);
                const daysInMonth = lastDay.getDate();
                const startingDayOfWeek = firstDay.getDay();

                // Add empty cells for days before month starts
                for (let i = 0; i < startingDayOfWeek; i++) {
                    const emptyDay = document.createElement('div');
                    emptyDay.className = 'calendar-day other-month';
                    calendarGrid.appendChild(emptyDay);
                }

                // Add days of the month
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayElement = document.createElement('div');
                    dayElement.className = 'calendar-day';
                    
                    const dayDate = new Date(this.currentDate.getFullYear(), this.currentDate.getMonth(), day);
                    const today = new Date();
                    
                    // Check if it's today
                    if (dayDate.toDateString() === today.toDateString()) {
                        dayElement.classList.add('today');
                    }

                    // Check for appointments on this day
                    const dayAppointments = appointments.filter(appointment => 
                        appointment.date.toDateString() === dayDate.toDateString()
                    );

                    if (dayAppointments.length > 0) {
                        const hasCompleted = dayAppointments.some(appointment => appointment.status === 'completed');
                        const hasScheduled = dayAppointments.some(appointment => appointment.status === 'scheduled');
                        
                        if (hasCompleted) {
                            dayElement.classList.add('completed-appointment');
                        } else if (hasScheduled) {
                            dayElement.classList.add('has-appointment');
                        }

                        // Add appointment details
                        const appointmentDetails = document.createElement('div');
                        appointmentDetails.className = 'appointment-details';
                        
                        dayAppointments.forEach(appointment => {
                            const appointmentDiv = document.createElement('div');
                            appointmentDiv.innerHTML = `
                                <h4>${appointment.therapy}</h4>
                                <p>Time: ${appointment.time}</p>
                                <p>Therapist: ${appointment.therapist}</p>
                                <span class="appointment-status ${appointment.status}">${appointment.status}</span>
                            `;
                            appointmentDetails.appendChild(appointmentDiv);
                        });
                        
                        dayElement.appendChild(appointmentDetails);
                    }

                    dayElement.innerHTML = `
                        <div class="day-number">${day}</div>
                        ${dayAppointments.length > 0 ? `
                            <div class="appointment-indicator">⭐</div>
                            <div class="appointment-time">${dayAppointments[0].time}</div>
                        ` : ''}
                    ` + dayElement.innerHTML;

                    calendarGrid.appendChild(dayElement);
                }

                // re-render therapy plan to reflect current month
                if (typeof window.renderTherapyPlan === 'function') {
                    window.renderTherapyPlan();
                }
            }
        }

        // Render Current Therapy Plan from appointments
        function renderTherapyPlan() {
            const grid = document.querySelector('.therapy-grid');
            if (!grid) return;
            const today = new Date();
            const scope = window.__currentCalendarMonth || { year: today.getFullYear(), month: today.getMonth() };

            // Filter appointments to current calendar month
            const scopedAppointments = appointments.filter(a => (
                a.date && a.date.getFullYear && a.date.getFullYear() === scope.year && a.date.getMonth() === scope.month
            ));

            // Group scoped appointments by therapy
            const byTherapy = scopedAppointments.reduce((acc, appt) => {
                const key = appt.therapy || 'Therapy';
                if (!acc[key]) acc[key] = [];
                acc[key].push(appt);
                return acc;
            }, {});

            // Build cards
            const fragments = [];
            Object.entries(byTherapy).forEach(([therapyName, items]) => {
                // Determine totals
                const totalPlanned = Math.max(items.length, 5); // default target 5
                const bookedCount = items.filter(i => i.status === 'scheduled' || i.status === 'completed').length;
                if (bookedCount === 0) return; // show only therapies that have bookings this month
                const progressPct = Math.min(100, Math.round((bookedCount / totalPlanned) * 100));

                // Next upcoming session
                const upcoming = appointments
                    .filter(i => i.status !== 'completed' && i.date >= today)
                    .sort((a, b) => a.date - b.date)[0];

                const duration = items.find(i => i.duration) ? (items.find(i => i.duration).duration + ' min') : '';
                const statusClass = bookedCount >= totalPlanned ? 'status-completed' : (upcoming ? 'status-scheduled' : 'status-active');
                const statusLabel = bookedCount >= totalPlanned ? 'Completed' : (upcoming ? 'Scheduled' : 'Active');

                const nextLabel = upcoming ? `${upcoming.date.toLocaleDateString()} ${upcoming.time || ''}` : '—';

                const card = `
                    <div class="therapy-item">
                        <div class="therapy-header">
                            <div class="therapy-name">${therapyName}</div>
                            <div class="therapy-status ${statusClass}">${statusLabel}</div>
                        </div>
                        <div class="therapy-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progressPct}%"></div>
                            </div>
                            <small>Progress: ${bookedCount}/${totalPlanned} sessions</small>
                        </div>
                        <div class="therapy-details">
                            <div><strong>Duration:</strong> ${duration}</div>
                            <div><strong>Next:</strong> ${nextLabel}</div>
                        </div>
                    </div>
                `;
                fragments.push(card);
            });

            grid.innerHTML = fragments.join('');
        }

        const symptomData = {
            labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6'],
            datasets: [{
                label: 'Pain Level',
                data: [7, 6.5, 6, 5.5, 5, 4.2],
                borderColor: '#e74c3c',
                backgroundColor: 'rgba(231, 76, 60, 0.1)',

                tension: 0.4,
                fill: true
            }, {
                label: 'Energy Level',
                data: [4, 4.5, 5, 5.8, 6.5, 7.8],
                borderColor: '#4caf50',
                backgroundColor: 'rgba(76, 175, 80, 0.1)',
                tension: 0.4,
                fill: true
            }]
        };

        // Initialize charts
        function initializeCharts() {
            // Weight Chart
            const weightCtx = document.getElementById('weightChart').getContext('2d');
            new Chart(weightCtx, {
                type: 'line',
                data: weightData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            min: 75,
                            max: 85,
                            grid: {
                                color: 'rgba(74, 124, 74, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });

            // Symptom Chart
            const symptomCtx = document.getElementById('symptomChart').getContext('2d');
            new Chart(symptomCtx, {
                type: 'line',
                data: symptomData,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                            labels: {
                                usePointStyle: true,
                                padding: 20
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 10,
                            grid: {
                                color: 'rgba(74, 124, 74, 0.1)'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Action button functions
        function editProfile() {
            showNotification('Edit Profile feature would open here', 'info');
            // In a real application, this would open a modal or navigate to edit page
        }

        function addVitalRecord() {
            showNotification('Add Vital Record modal would open here', 'info');
            // In a real application, this would open a form modal
        }

        function downloadMedicalSummary() {
            // Show loading animation
            showNotification('Generating medical summary...', 'info');
            
            // Create a more detailed medical summary
            const medicalSummary = generateMedicalSummary();
            
            // Simulate processing time with progress
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 20;
                if (progress <= 100) {
                    showNotification(`Generating medical summary... ${progress}%`, 'info');
                }
            }, 300);
            
            setTimeout(() => {
                clearInterval(progressInterval);
                
                // Create and download the summary
                const element = document.createElement('a');
                const file = new Blob([medicalSummary], {type: 'text/plain'});
                element.href = URL.createObjectURL(file);
                element.download = `Medical_Summary_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(element);
                element.click();
                document.body.removeChild(element);
                
                showNotification('Medical summary downloaded successfully!', 'success');
            }, 2000);
        }

        function generateMedicalSummary() {
            const currentDate = new Date().toLocaleDateString();
            return `
AYURSUTRA MEDICAL SUMMARY
Generated on: ${currentDate}
Patient: Rajesh Kumar (PK-2024-001)

=== PATIENT INFORMATION ===
Name: Rajesh Kumar
Age: 45 years
Gender: Male
Contact: +91 98765 43210
Email: rajesh.kumar@email.com
Location: Delhi, India
Member Since: January 2024

=== MEDICAL HISTORY ===
1. Hypertension (Moderate)
   - Diagnosed: 2019
   - Medication: Amlodipine 5mg daily
   
2. Diabetes Type 2 (Moderate)
   - Diagnosed: 2020
   - HbA1c: 7.2%
   - Medication: Metformin 500mg twice daily
   
3. Chronic Back Pain (High)
   - L4-L5 disc degeneration
   - Duration: 3 years
   - Primary reason for Ayurvedic treatment
   
4. Allergies (Low)
   - Penicillin (severe)
   - Shellfish (mild)
   - Dust mites (mild)
   
5. Past Procedures (Low)
   - Appendectomy (2015)
   - Colonoscopy (2022) - Normal findings

=== CURRENT VITAL SIGNS ===
Blood Pressure: 142/88 mmHg (↓ 5 points)
Pulse Rate: 78 bpm (Stable)
Weight: 78.5 kg (↓ 2.3 kg)
BMI: 26.8 (↓ 0.8)

=== THERAPY PLAN ===
1. Abhyanga Massage (Active)
   - Progress: 8/10 sessions completed (80%)
   - Frequency: 3x/week
   - Duration: 60 min
   - Next: Tomorrow 9 AM
   
2. Panchakarma (Active)
   - Progress: 3/5 phases completed (60%)
   - Current Phase: Virechana
   - Duration: 120 min
   - Next: Friday 2 PM
   
3. Shirodhara (Scheduled)
   - Progress: 2/5 sessions completed (40%)
   - Frequency: 2x/week
   - Duration: 45 min
   - Next: Monday 11 AM

=== PROGRESS TRACKING ===
Average Pain Score: 4.2/10
Adherence Rate: 92%
Energy Level: 7.8/10
Sleep Quality: 6.5/10

=== UPCOMING APPOINTMENTS ===
- March 12: Shirodhara (14:00) - Dr. Priya Patel
- March 15: Abhyanga Massage (11:00) - Dr. Anjali Sharma
- March 20: Basti Treatment (09:30) - Dr. Amit Singh
- March 25: Panchakarma (16:00) - Dr. Rajesh Kumar

=== RECOMMENDATIONS ===
1. Continue current therapy plan as scheduled
2. Monitor blood pressure regularly
3. Maintain diabetes management routine
4. Follow dietary recommendations
5. Regular follow-up appointments

This summary was generated by AyurSutra Patient Management System.
For any questions, please contact your healthcare provider.

---
© 2024 AyurSutra - Traditional Ayurvedic Healthcare
            `;
        }

        function scheduleAppointment() {
            showNotification('Schedule Appointment feature would open here', 'info');
            // In a real application, this would open a scheduling modal
        }

        function viewReports() {
            showNotification('View Reports feature would open here', 'info');
            // In a real application, this would navigate to reports page
        }

        function showNotification(message, type = 'info') {
                const notification = document.createElement('div');
                notification.className = `notification-toast notification-${type}`;
                notification.textContent = message;
                
                notification.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    background: ${type === 'success' ? '#4a7c4a' : type === 'error' ? '#e74c3c' : '#3498db'};
                    color: white;
                    padding: 1rem 1.5rem;
                    border-radius: 8px;
                    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
                    z-index: 3000;
                    animation: slideIn 0.3s ease;
                `;

                document.body.appendChild(notification);

                setTimeout(() => {
                    notification.style.animation = 'slideOut 0.3s ease';
                    setTimeout(() => {
                        if (document.body.contains(notification)) {
                            document.body.removeChild(notification);
                        }
                    }, 300);
                }, 3000);
        }

        // Feedback modal functions
        function showFeedbackModal() {
  document.getElementById('feedbackModal').style.display = 'flex';
}

function hideFeedbackModal() {
  document.getElementById('feedbackModal').style.display = 'none';
}

function submitFeedback() {
  const feedback = {
    date: document.querySelector('input[type="date"]').value,
    rating: document.querySelectorAll('#rating button.text-yellow-400').length,
    painLevel: document.querySelector('input[type="range"]:nth-of-type(1)').value,
    sleepQuality: document.querySelector('input[type="range"]:nth-of-type(2)').value,
    sideEffects: document.querySelector('textarea:nth-of-type(1)').value,
    improvements: document.querySelector('textarea:nth-of-type(2)').value
  };

  // Show success notification
  showNotification('Feedback submitted successfully', 'success');

  // Reset form
  document.querySelectorAll('#rating button').forEach(btn => {
    btn.classList.remove('text-yellow-400');
    btn.classList.add('text-gray-400');
  });
  document.querySelectorAll('input[type="range"]').forEach(range => range.value = 5);
  document.querySelectorAll('textarea').forEach(textarea => textarea.value = '');
}

// Star rating functionality
document.querySelectorAll('#rating button').forEach((star, index) => {
  star.addEventListener('click', () => {
    document.querySelectorAll('#rating button').forEach((s, i) => {
      s.classList.toggle('text-yellow-400', i <= index);
      s.classList.toggle('text-gray-400', i > index);
    });
  });
});

// Range sliders value display
document.querySelectorAll('input[type="range"]').forEach(range => {
  range.addEventListener('input', (e) => {
    e.target.nextElementSibling.textContent = e.target.value;
  });
});

        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            initializeCharts();
            new Calendar();
            // initial render uses current month set by calendar
            window.renderTherapyPlan = renderTherapyPlan;
            renderTherapyPlan();
            
            // Add animation delays to sections
            const sections = document.querySelectorAll('.dashboard-section');
            sections.forEach((section, index) => {
                section.style.animationDelay = `${index * 0.1}s`;
            });
        });

        // Add CSS animations
        const animationStyle = document.createElement('style');
        animationStyle.textContent = `
            @keyframes slideIn {
                from { transform: translateX(100%); opacity: 0; }
                to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOut {
                from { transform: translateX(0); opacity: 1; }
                to { transform: translateX(100%); opacity: 0; }
            }
        `;
        document.head.appendChild(animationStyle);
    </script>

    <!-- Footer -->
  <footer class="bg-green-800 text-white py-12">
    <div class="container mx-auto px-4 grid grid-cols-1 md:grid-cols-3 gap-8">
        <div>
            <h5 class="text-lg font-bold mb-4">Contact Us</h5>
            <p class="flex items-center mb-2"><i class="fas fa-map-marker-alt mr-2"></i> 123 Wellness Street, Ayurveda City</p>
            <p class="flex items-center mb-2"><i class="fas fa-phone mr-2"></i> +91 98765 4xxxx</p>
            <p class="flex items-center"><i class="fas fa-envelope mr-2"></i> info@panchakarma-center.com</p>
        </div>
        <div>
            <h5 class="text-lg font-bold mb-4">Quick Links</h5>
            <ul class="space-y-2">
                <li><a href="#" class="hover:underline">Treatments</a></li>
                <li><a href="#" class="hover:underline">Consultation</a></li>
                <li><a href="#" class="hover:underline">Products</a></li>
                <li><a href="#" class="hover:underline">Appointment</a></li>
            </ul>
        </div>
        <div>
            <h5 class="text-lg font-bold mb-4">Operating Hours</h5>
            <ul class="space-y-2">
                <li>Monday - Friday: 9:00 AM - 7:00 PM</li>
                <li>Saturday: 9:00 AM - 5:00 PM</li>
                <li>Sunday: 10:00 AM - 4:00 PM</li>
            </ul>
        </div>
    </div>
</footer>

</body>
</html>